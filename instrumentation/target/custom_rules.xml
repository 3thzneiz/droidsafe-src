<?xml version="1.0" encoding="UTF-8"?>
<project name="PickContacts" default="help">
<property name="out.dex.input.absolute.dir" value="bin/classes.mod"/>
<property name="classes.mod"  value="${out.dex.input.absolute.dir}"/>
<property name="classes.orig" value="bin/classes"/>
<property name="droidsafe.dir" value="${env.APAC_HOME}"/>
<property name="instr.tool.dir" value="${droidsafe.dir}/tools/instrumentation/bin"/>
<property name="instr.tool.jar" value="${instr.tool.dir}/droidsafe-instr.jar"/>
<property name="instr.lib.package" value="droidsafe/instrumentation"/>
<property name="instr.code.injector" value="${instr.tool.dir}/droidsafe-instr-insert"/>

<target name="-post-compile">
    <echo>
        Instrumentation code injection
    </echo> 
    <mkdir dir="${classes.mod}"/>
    <copy todir="${classes.mod}" flatten="false">
        <fileset dir="bin/classes/"/>
    </copy>
    <exec command="${instr.code.injector}">
        <arg value="-process-dir ${classes.orig} -d ${classes.mod}"/>
    </exec>
    <unjar src="${instr.tool.jar}"  dest="${classes.mod}">
        <patternset>
            <include name="**/instrumentation/*.class"/>
        </patternset>
    </unjar>
    <delete dir="${classes.orig}"/>
    </target>
</project>
